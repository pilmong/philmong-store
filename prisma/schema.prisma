generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- Shared Internal Models (from Philmong App) ---

enum PaymentMethod {
  TRANSFER
  CASH
  CREDIT_CARD
  CHECK_CARD
}

enum PaymentStatus {
  ORDERED
  RECEIVED
  COMPLETED
  CANCELLED
  UNPAID
  PAID
  REFUNDED
}

enum UsageType {
  BUSINESS
  PERSONAL
}

model Purchase {
  id            String        @id @default(uuid())
  vendorName    String
  date          DateTime
  paymentMethod PaymentMethod @default(CREDIT_CARD)
  status        PaymentStatus @default(ORDERED)
  totalAmount   Int           @default(0)
  items         PurchaseItem[]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model PurchaseItem {
  id            String    @id @default(uuid())
  purchaseId    String
  purchase      Purchase  @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  name          String
  quantity      Int
  unitPrice     Int
  amount        Int
  usage         UsageType
  note          String?
  isChecked     Boolean   @default(false)
  discountValue Int       @default(0)
  discountType  String    @default("UNIT")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Vendor {
  id        String   @id @default(uuid())
  name      String   @unique
  contact   String?
  website   String?
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- Sales & Product Models (Shared & Extended) ---

enum WorkDivision {
  IMMEDIATE_SUB_PORTIONING
  COOKING
  PROCESSING
}

enum ProductStatus {
  SELLING
  NOT_SELLING
  PENDING
}

enum ProductType {
  REGULAR
  DAILY
  SPECIAL
  LUNCH_BOX
  SALAD
  ZONE
  DISCOUNT
}

model Product {
  id              String        @id @default(cuid())
  name            String
  basePrice       Int           @default(0)
  type            ProductType
  category        ProductCategory?
  workDivision    WorkDivision  @default(IMMEDIATE_SUB_PORTIONING)
  status          ProductStatus @default(SELLING)
  standardQuantity Int?
  sellingDate     DateTime?
  sellingEndDate  DateTime?
  description     String?
  plannedQuantity Int?
  
  prices          ClientProductPrice[]
  lunchBoxConfig  LunchBoxConfig?
  orderRequests   OrderRequestItem[]
  saleItems       SaleItem[]
  menuPlans       MenuPlan[]
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([type])
  @@index([sellingDate])
}

enum ProductCategory {
  TODAY_MENU
  MAIN_DISH
  SOUP
  SIDE_DISH
  KIMCHI
  PICKLE
  SAUCE
  LUNCH_RICE
  LUNCH_SOUP
  LUNCH_MAIN
  LUNCH_SIDE
  SALAD_MAIN
}

model Client {
  id              String        @id @default(cuid())
  name            String
  code            String?       @unique
  managerEmail    String?
  contact         String?
  category        String?
  address         String?
  isVatInclusive  Boolean       @default(true)
  note            String?
  
  customPrices    ClientProductPrice[]
  orderRequests   OrderRequest[]
  clientOrders    ClientOrder[]
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model ClientProductPrice {
  id              String    @id @default(cuid())
  clientId        String
  productId       String
  customPrice     Int
  client          Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  product         Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([clientId, productId])
}

model LunchBoxConfig {
  id              String    @id @default(cuid())
  productId       String    @unique
  product         Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  layoutType      String    @default("LUNCH_BOX")
  slotA           String?   
  slotB           String?
  slotC           String?
  slotD           String?
  slotE           String?
  slotF           String?
  slotG           String?
  slotH           String?
  slotI           String?
  slotJ           String?
  slotK           String?
  slotL           String?
  slotM           String?
  slotN           String?
  slotO           String?
  slotP           String?
  slotQ           String?
  slotR           String?
  slotS           String?
  slotT           String?
  slotU           String?
  slotV           String?
  slotW           String?
  slotX           String?
  slotY           String?
  slotZ           String?
  slotAA          String?
}

model OrderRequest {
  id              String    @id @default(cuid())
  clientId        String
  client          Client    @relation(fields: [clientId], references: [id])
  targetDate      DateTime
  items           OrderRequestItem[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model OrderRequestItem {
  id              String    @id @default(cuid())
  orderId         String
  productId       String?   
  itemName        String?   
  itemCategory    String?   
  quantity        Int
  order           OrderRequest @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product?     @relation(fields: [productId], references: [id])
}

// --- Philmong Store Specific Models ---

model User {
  id        String   @id @default(uuid())
  name      String
  phone     String   @unique
  password  String
  adminNote String?
  orders    Order[]
  coupons   UserCoupon[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id            String   @id @default(uuid())
  orderNumber   String   @unique 
  customerName  String
  customerPhone String
  password      String?  
  totalAmount   Int
  pickupDate    String   
  pickupTime    String?  
  deliveryType  DeliveryType
  address       String?
  detailAddress String?
  deliveryZoneId String?
  deliveryFee   Int      @default(0)
  requestNote   String?
  status        OrderStatus @default(PENDING)
  paymentStatus PaymentStatus @default(UNPAID)
  paymentDeadline DateTime?
  paymentNotified Boolean   @default(false)
  items         OrderItem[]
  userId        String?
  user          User?    @relation(fields: [userId], references: [id])
  couponId      String?
  coupon        Coupon?  @relation(fields: [couponId], references: [id])
  discountAmount Int     @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model OrderItem {
  id          String   @id @default(uuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productName String
  price       Int
  quantity    Int
  amount      Int      
  menuPlanId  String?
  menuPlan    MenuPlan? @relation(fields: [menuPlanId], references: [id])
}

model MenuPlan {
  id          String   @id @default(uuid())
  planDate    DateTime 
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  price       Int      
  quantityLimit Int?   
  soldQuantity  Int    @default(0)
  descriptionOverride String?
  status      PlanStatus @default(PLANNED)
  orderItems  OrderItem[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@index([planDate])
}

model DeliveryZone {
  id          String   @id @default(uuid())
  name        String
  price       Int
  areas       String[] 
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Coupon {
  id             String   @id @default(uuid())
  name           String
  code           String?  @unique
  discountAmount Int
  minOrderAmount Int
  isActive       Boolean  @default(true)
  isAuto         Boolean  @default(false)
  validFrom      DateTime? @default(now())
  validUntil     DateTime?
  usedOrders     Order[]
  userCoupons    UserCoupon[]
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model UserCoupon {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  couponId  String
  coupon    Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)
  isUsed    Boolean  @default(false)
  createdAt DateTime @default(now())
  @@unique([userId, couponId])
}

model ClientOrder {
  id        String   @id @default(uuid())
  clientId  String
  client    Client   @relation(fields: [clientId], references: [id])
  date      DateTime 
  lunchBoxQuantity Int @default(0)
  saladQuantity    Int @default(0)
  status    OrderStatus @default(PENDING)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@unique([clientId, date])
}

// --- Legacy & Support Models ---

model Sale {
  id              String      @id @default(cuid())
  source          String      @default("NAVER")
  customerName    String?
  customerPhone   String?
  pickupType      String?
  address         String?
  deliveryFee     Int         @default(0)
  discountValue   Int         @default(0)
  totalAmount     Int
  status          OrderStatus @default(PENDING)
  utilizationDate DateTime?
  items           SaleItem[]
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model SaleItem {
  id              String      @id @default(cuid())
  saleId          String
  productId       String?
  customName      String?
  quantity        Int
  price           Int
  sale            Sale        @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product         Product?    @relation(fields: [productId], references: [id])
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  READY
  COMPLETED
  CANCELLED
  STANDBY
  ACCEPTED
  PACKING
  DELIVERY_READY
}

enum DeliveryType {
  PICKUP
  DELIVERY
}

enum PlanStatus {
  PLANNED
  OPEN
  CLOSED
  SOLD_OUT
}
// 스토어 운영 정책 설정
model SystemPolicy {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt
}
// 휴무일 관리
model Holiday {
  id            String   @id @default(uuid())
  date          DateTime @unique
  reason        String?
  category      String   @default("HOLIDAY")
  type          String   @default("TEMPORARY")
  isStoreClosed Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
